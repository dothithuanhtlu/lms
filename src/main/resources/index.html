<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Learning Assistant - Trợ lý học tập thông minh</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Markdown parser and syntax highlighting -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chat-container {
            width: 100%;
            max-width: 800px;
            height: 90vh;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .chat-header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .chat-header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .chat-header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .online-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .message-content {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 20px;
            position: relative;
            word-wrap: break-word;
            line-height: 1.5;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.bot .message-content {
            background: #f8fafc;
            color: #334155;
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 5px;
        }

        /* Markdown Content Styling */
        .message-content.markdown-content {
            line-height: 1.7;
        }

        .message-content h1,
        .message-content h2,
        .message-content h3,
        .message-content h4,
        .message-content h5,
        .message-content h6 {
            margin: 15px 0 10px 0;
            font-weight: bold;
            color: #1e293b;
        }

        .message-content h1 {
            font-size: 1.5em;
            color: #4f46e5;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 8px;
        }

        .message-content h2 {
            font-size: 1.3em;
            color: #7c3aed;
        }

        .message-content h3 {
            font-size: 1.2em;
            color: #059669;
        }

        .message-content h4 {
            font-size: 1.1em;
            color: #dc2626;
        }

        .message-content ul,
        .message-content ol {
            margin: 10px 0;
            padding-left: 25px;
        }

        .message-content li {
            margin: 5px 0;
            line-height: 1.6;
        }

        .message-content p {
            margin: 10px 0;
            line-height: 1.7;
        }

        .message-content strong {
            font-weight: 600;
            color: #1e293b;
        }

        .message-content em {
            font-style: italic;
            color: #64748b;
        }

        .message-content code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
            color: #dc2626;
            border: 1px solid #e2e8f0;
        }

        .message-content pre {
            background: #1e293b;
            color: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .message-content pre code {
            background: none;
            padding: 0;
            border: none;
            color: inherit;
        }

        .message-content blockquote {
            border-left: 4px solid #4f46e5;
            margin: 15px 0;
            padding: 10px 15px;
            background: #f8fafc;
            border-radius: 0 8px 8px 0;
            font-style: italic;
            color: #64748b;
        }

        .message-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .message-content th,
        .message-content td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .message-content th {
            background: #f8fafc;
            font-weight: 600;
            color: #1e293b;
        }

        .message-content tr:last-child td {
            border-bottom: none;
        }

        .message-content hr {
            border: none;
            height: 1px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            margin: 20px 0;
            border-radius: 1px;
        }

        /* Emoji and Icons */
        .message-content .emoji {
            font-size: 1.2em;
            vertical-align: middle;
        }

        /* Special formatting for lists with emojis */
        .message-content li::marker {
            color: #4f46e5;
        }

        /* Code block language labels */
        .message-content pre[class*="language-"] {
            position: relative;
        }

        .message-content pre[class*="language-"]::before {
            content: attr(class);
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 0.7em;
            color: #94a3b8;
            text-transform: uppercase;
            font-family: inherit;
        }

        /* Enhanced Chat Input Styling */
        .chat-input-container {
            padding: 25px;
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border-top: 1px solid #e2e8f0;
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            position: relative;
        }

        .chat-input {
            flex: 1;
            min-height: 56px;
            max-height: 120px;
            padding: 18px 24px;
            border: 2px solid #e2e8f0;
            border-radius: 28px;
            outline: none;
            font-size: 1rem;
            font-family: inherit;
            resize: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            line-height: 1.5;
        }

        .chat-input:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1), 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .chat-input:hover {
            border-color: #c7d2fe;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
        }

        .chat-input::placeholder {
            color: #94a3b8;
            font-style: italic;
        }

        .send-button {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(79, 70, 229, 0.25);
            position: relative;
            overflow: hidden;
        }

        .send-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), transparent);
            border-radius: 50%;
            transition: opacity 0.3s ease;
            opacity: 0;
        }

        .send-button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4);
        }

        .send-button:hover::before {
            opacity: 1;
        }

        .send-button:active {
            transform: translateY(0) scale(0.98);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: 0 2px 4px rgba(79, 70, 229, 0.15);
        }

        /* Enhanced Message Time Styling */
        .message-time {
            font-size: 0.75rem;
            opacity: 0.6;
            margin-top: 8px;
            font-weight: 500;
        }

        /* Enhanced Typing Indicator */
        .typing-indicator {
            display: none;
            padding: 15px 20px;
            background: rgba(248, 250, 252, 0.8);
            border-radius: 20px;
            border-bottom-left-radius: 5px;
            margin-bottom: 20px;
            max-width: 70%;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.5);
        }

        .typing-dots {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            60%,
            100% {
                transform: translateY(0);
                opacity: 0.4;
            }

            30% {
                transform: translateY(-15px);
                opacity: 1;
            }
        }

        /* Enhanced Welcome Message */
        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
            background: linear-gradient(135deg, rgba(248, 250, 252, 0.8), rgba(255, 255, 255, 0.9));
            border-radius: 20px;
            margin: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.5);
        }

        .welcome-message i {
            font-size: 3rem;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            display: block;
        }

        .welcome-message h2 {
            margin-bottom: 15px;
            color: #1e293b;
            font-weight: 600;
            font-size: 1.3rem;
        }

        .welcome-message p {
            margin-bottom: 25px;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .quick-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 25px;
        }

        .quick-action {
            padding: 12px 20px;
            background: linear-gradient(135deg, #f8fafc, #ffffff);
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.9rem;
            font-weight: 500;
            color: #475569;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .quick-action:hover {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border-color: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        /* Enhanced Scrollbar */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(226, 232, 240, 0.3);
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #3730a3, #6b21a8);
        }

        /* Enhanced Message Content */
        .message.bot .message-content {
            background: linear-gradient(135deg, #f8fafc, #ffffff);
            color: #334155;
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(10px);
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border-bottom-right-radius: 5px;
            box-shadow: 0 2px 8px rgba(79, 70, 229, 0.3);
        }

        /* Enhanced Avatar */
        .message-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        @media (max-width: 768px) {
            .chat-container {
                height: 100vh;
                border-radius: 0;
                margin: 0;
            }

            .message-content {
                max-width: 85%;
            }

            .chat-input-container {
                padding: 20px;
            }

            .chat-input {
                min-height: 50px;
                padding: 15px 20px;
                font-size: 0.95rem;
            }

            .send-button {
                width: 50px;
                height: 50px;
            }

            .quick-actions {
                gap: 8px;
            }

            .quick-action {
                padding: 10px 16px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>

<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="online-indicator">
                <div class="status-dot"></div>
                <span style="font-size: 0.8rem;">Online</span>
            </div>
            <h1><i class="fas fa-robot"></i> AI Learning Assistant</h1>
            <p>Trợ lý học tập thông minh - Hỗ trợ học tập 24/7</p>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <i class="fas fa-graduation-cap"></i>
                <h2>🎓 Chào mừng bạn đến với AI Learning Assistant!</h2>
                <p>Tôi có thể giúp bạn giải đáp các thắc mắc về học tập, giải thích khái niệm, hướng dẫn bài tập và
                    nhiều hơn nữa. Hãy bắt đầu cuộc trò chuyện!</p>

                <div class="quick-actions">
                    <div class="quick-action"
                        onclick="sendQuickMessage('Giải thích khái niệm lập trình hướng đối tượng')">
                        🔧 Lập trình OOP
                    </div>
                    <div class="quick-action" onclick="sendQuickMessage('Cách học toán hiệu quả')">
                        📊 Học toán hiệu quả
                    </div>
                    <div class="quick-action" onclick="sendQuickMessage('Thời gian hiện tại')">
                        ⏰ Thời gian hiện tại
                    </div>
                    <div class="quick-action" onclick="sendQuickMessage('Tính 15 + 25')">
                        🧮 Tính toán
                    </div>
                    <div class="quick-action" onclick="sendQuickMessage('Hướng dẫn xây dựng chatbot với LangChain4j')">
                        🤖 Xây dựng Chatbot
                    </div>
                    <div class="quick-action" onclick="sendQuickMessage('Giải thích cách hoạt động của Spring Boot')">
                        🌱 Spring Boot
                    </div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="message">
                    <div class="message-avatar bot">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <textarea id="messageInput" class="chat-input"
                    placeholder="💬 Nhập câu hỏi của bạn... (Enter để gửi, Shift+Enter để xuống dòng)" rows="1"
                    onkeypress="handleKeyPress(event)" oninput="autoResize(this)"></textarea>
                <button id="sendButton" class="send-button" onclick="sendMessage()" title="Gửi tin nhắn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        let isWaitingForResponse = false;

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';

            // Add visual feedback
            if (textarea.value.trim()) {
                textarea.style.borderColor = '#4f46e5';
            } else {
                textarea.style.borderColor = '#e2e8f0';
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function sendQuickMessage(message) {
            const input = document.getElementById('messageInput');
            input.value = message;

            // Add visual feedback
            input.style.transform = 'scale(1.02)';
            setTimeout(() => {
                input.style.transform = 'scale(1)';
                sendMessage();
            }, 150);
        }

        function addMessage(content, isUser = false, showTime = true) {
            const messagesContainer = document.getElementById('chatMessages');
            const welcomeMessage = messagesContainer.querySelector('.welcome-message');
            if (welcomeMessage) {
                welcomeMessage.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;

            const time = showTime ? new Date().toLocaleTimeString('vi-VN', {
                hour: '2-digit',
                minute: '2-digit'
            }) : '';

            // Process content - parse markdown for bot messages
            let processedContent = content;
            if (!isUser && typeof marked !== 'undefined') {
                // Configure marked options
                marked.setOptions({
                    breaks: true,
                    gfm: true,
                    highlight: function (code, lang) {
                        if (typeof Prism !== 'undefined' && Prism.languages[lang]) {
                            return Prism.highlight(code, Prism.languages[lang], lang);
                        }
                        return code;
                    }
                });
                processedContent = marked.parse(content);
            }

            messageDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-${isUser ? 'user' : 'robot'}"></i>
                </div>
                <div class="message-content ${!isUser ? 'markdown-content' : ''}">
                    ${processedContent}
                    ${showTime ? `<div class="message-time">${time}</div>` : ''}
                </div>
            `;

            const typingIndicator = document.getElementById('typingIndicator');
            messagesContainer.insertBefore(messageDiv, typingIndicator);

            // Highlight code blocks if Prism is available
            if (!isUser && typeof Prism !== 'undefined') {
                Prism.highlightAllUnder(messageDiv);
            }

            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'block';
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const message = input.value.trim();

            if (!message || isWaitingForResponse) return;

            // Disable input and button
            isWaitingForResponse = true;
            sendButton.disabled = true;
            input.disabled = true;

            // Add user message
            addMessage(message, true);
            input.value = '';
            input.style.height = 'auto';

            // Show typing indicator
            showTypingIndicator();

            try {
                // Encode message for URL
                const encodedMessage = encodeURIComponent(message);
                const response = await fetch(`http://localhost:8080/chatbot/${encodedMessage}`);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const botResponse = await response.text();

                // Hide typing indicator and add bot response
                hideTypingIndicator();
                addMessage(botResponse);

            } catch (error) {
                console.error('Error:', error);
                hideTypingIndicator();
                addMessage('Xin lỗi, có lỗi xảy ra khi xử lý yêu cầu của bạn. Vui lòng thử lại sau.', false);
            } finally {
                // Re-enable input and button
                isWaitingForResponse = false;
                sendButton.disabled = false;
                input.disabled = false;
                input.focus();
            }
        }

        // Auto-focus on input when page loads
        window.addEventListener('load', () => {
            document.getElementById('messageInput').focus();
        });

        // Add some CSS animations
        document.head.insertAdjacentHTML('beforeend', `
            <style>
                .message {
                    animation: slideIn 0.3s ease-out;
                }
                
                @keyframes slideIn {
                    from {
                        opacity: 0;
                        transform: translateY(20px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
            </style>
        `);
    </script>
</body>

</html>